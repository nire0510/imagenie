/*
imagenie v.0.0.1 - Image manipulation made easy (JS library)
22-02-2015
*/
!function(a,b){"function"==typeof define&&define.amd?define(b):a.Imagenie=b(a)}(this,function(){"use strict";function a(a){!function(){"string"==typeof a?f.isValidURL(a)?f.log("Image URL"):document.querySelectorAll(a).length>0&&(f.log("Image elements selector"),[].forEach.call(document.querySelectorAll(a),function(a){"IMG"===a.nodeName&&(a.dataset.src=a.src,e.push({elem:a,source:c(a)}))})):Array.isArray(a)?f.log("Array of something"):"NodeList"===a.constructor.name&&(f.log("Image elements collection"),[].forEach.call(a,function(a){"IMG"===a.nodeName&&(a.dataset.src=a.src,e.push({elem:a,source:c(a)}))}))}()}function b(a){return h.drawImage(a,0,0,a.width,a.height),h.getImageData(0,0,a.width,a.height).data}function c(a){return h.drawImage(a,0,0,a.width,a.height),h.canvas.toDataURL()}function d(a){e.forEach(function(b){var c,d;h.drawImage(b.elem,0,0,b.elem.width,b.elem.height),c=h.getImageData(0,0,b.elem.width,b.elem.height),d=c.data;for(var e=0,f=d.length;f>e;e+=4)a(d,e);h.context.putImageData(c,0,0),b.elem.src=h.canvas.toDataURL()})}var e=[],f={log:function(){g.debug&&console.log.apply(console,arguments)},isValidURL:function(a){return a.search(/^https?:\/\//)>=0}},g={debug:!0},h={_init:function(){h.canvas=document.createElement("canvas"),h.context=h.canvas.getContext("2d")},reset:function(a,b){h.canvas.height=b,h.canvas.width=a,h.context.clearRect(0,0,a,b)},drawImage:function(a,b,c,d,e){h.reset(d,e),h.context.drawImage(a,b,c,d,e)},cropImage:function(a,b,c,d,e,f,g,i,j){h.clear(d,e),h.context.drawImage(a,b,c,d,e,f,g,i,j)},getImageData:function(a,b,c,d){return h.context.getImageData(a,b,c,d)}};return h._init(),a.prototype.size=function(){return e.map(function(a){return{src:a.elem.dataset.src,displayWidth:a.elem.width,displayHeight:a.elem.height,naturalWidth:a.elem.naturalWidth,naturalHeight:a.elem.naturalHeight}})},a.prototype.pixel=function(a,c){return a>=0&&c>=0?e.map(function(d){var e=b(d.elem);return{R:e[4*(d.elem.width*c+a)],G:e[4*(d.elem.width*c+a)+1],B:e[4*(d.elem.width*c+a)+2],A:e[4*(d.elem.width*c+a)+3]}}):void 0},a.prototype.transparency=function(){return e.map(function(a){for(var c=b(a),d=0;d<a.elem.height;d++)for(var e=0;e<a.elem.width;e++)if(c[4*(a.elem.width*d+e)+3]<255)return!0;return!1})},a.prototype.crop=function(a,b,c,d){return a>=0&&b>=0&&c>0&&d>0&&e.forEach(function(e){h.cropImage(e.elem,a,b,c,d,0,0,c,d),e.elem.src=h.canvas.toDataURL()}),this},a.prototype.alpha=function(a,b){return a>=0&&1>=a&&d(function(c,d){(!b||c[d+3]>0)&&(c[d+3]=255*a)}),this},a.prototype.scale=function(a){return a>0&&e.forEach(function(b){h.drawImage(b.elem,0,0,b.elem.width*Math.max(0,a),b.elem.height*Math.max(0,a)),b.elem.src=h.canvas.toDataURL()}),this},a.prototype.reset=function(){return e.forEach(function(a){a.elem.src=a.source}),this},a.prototype.grayscale=function(){return d(function(a,b){var c=.34*a[b]+.5*a[b+1]+.16*a[b+2];a[b]=c,a[b+1]=c,a[b+2]=c}),this},a.prototype.mirror=function(){return e.forEach(function(a){h.reset(a.elem.width,a.elem.height),h.context.save(),h.context.translate(a.elem.width/2,a.elem.height/2),h.context.scale(-1,1),h.context.drawImage(a.elem,-a.elem.width/2,-a.elem.height/2,a.elem.width,a.elem.height),h.context.restore(),a.elem.src=h.canvas.toDataURL()}),this},a.prototype.resize=function(a,b){return a>=0&&b>=0&&e.forEach(function(c){h.drawImage(c.elem,0,0,Math.max(0,a),Math.max(0,b)),c.elem.src=h.canvas.toDataURL()}),this},a.prototype.rotate=function(a){return a>=0&&e.forEach(function(b){h.reset(b.elem.width,b.elem.height),h.context.save(),h.context.translate(b.elem.width/2,b.elem.height/2),h.context.rotate(a%360*Math.PI/180),h.context.drawImage(b.elem,-b.elem.width/2,-b.elem.height/2,b.elem.width,b.elem.height),h.context.restore(),b.elem.src=h.canvas.toDataURL()}),this},a.prototype.invert=function(){return d(function(a,b){a[b]=255-a[b],a[b+1]=255-a[b+1],a[b+2]=255-a[b+2]}),this},a.prototype.swap=function(a,b){return a&&b&&d(function(c,d){a.r&&a.r!==c[d]||a.g&&a.g!==c[d+1]||a.b&&a.b!==c[d+2]||a.a&&a.a!==c[d+3]||["r","g","b","a"].forEach(function(a,e){b.hasOwnProperty(a)&&(c[d+e]=b[a])})}),this},a});